{% load static %}
<link rel="stylesheet" href="{% static 'home.css' %}">
<link rel="stylesheet" href="{% static 'style.css' %}">
<link rel="stylesheet" href="{% static 'friendspage.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css">
<link rel="stylesheet" href="{% static 'login.css' %}">
<link rel="stylesheet" href="{% static 'register.css' %}">
<link rel="stylesheet" href="{% static 'liveChat.css' %}">
<link rel="stylesheet" href="{% static 'home.css' %}">
<link rel="stylesheet" href="{% static 'style.css' %}">
<link rel="stylesheet" href="{% static 'settings-page.css' %}">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Alata&family=Fugaz+One&family=Funnel+Display:wght@300&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Fugaz+One&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Alata&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Alata&family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="{% static 'js/friendspage.js' %}"></script>

<section id="friendspage">
    <div class="gameMode">
        <h3 style="text-align: left;">Gestion des amis</h3>
    </div>

    <div class="friends-content">
        <!-- Barre de recherche -->

        <!-- Onglets -->
        <ul class="nav nav-tabs mb-4" id="friendsTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="friends-tab" data-bs-toggle="tab" data-bs-target="#friends" type="button" role="tab" aria-controls="friends" aria-selected="true">
                    <span class="badge bg-primary rounded-pill ms-2"></span>
                    <i class="bi bi-people-fill me-2"></i>Mes amis
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="requests-tab" data-bs-toggle="tab" data-bs-target="#requests" type="button" role="tab" aria-controls="requests" aria-selected="false">
                    <i class="bi bi-envelope-fill me-2"></i>Demandes
                    <span class="badge bg-danger rounded-pill ms-2">!</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="blocked-tab" data-bs-toggle="tab" data-bs-target="#blocked" type="button" role="tab" aria-controls="blocked" aria-selected="false">
                    <i class="bi bi-slash-circle-fill me-2"></i>Bloqués
                </button>
            </li>
            <button class="btn btn-primary" type="button" id="add-friend-btn">
                <i class="bi bi-person-plus-fill me-2"></i>Ajouter
            </button>
        </ul>

        <!-- Contenu des onglets -->
        <div class="tab-content">
            <!-- Onglet Mes amis -->
            <div class="tab-pane fade show active" id="friends" role="tabpanel" aria-labelledby="friends-tab">
                <div class="row row-cols-1 row-cols-md-2 g-4">
               
              
                    <!-- Ami 3 -->
                    <div class="col">
                        <div class="card-custom friend-card">
                            <div class="card-body">
                                <div class="friend-header d-flex align-items-center">
                                    <div class="friend-avatar-wrapper me-3">
                                        <div class="friend-avatar">
                                            <img src="../media/ficello.png" alt="Avatar">
                                        </div>
                                    </div>
                                    
                                    <div class="friend-info">
                                        <h5 class="friend-name">Joueur3</h5>
                                        <div class="friend-status">
                                            <span class="status-indicator online"></span>
                                            <span class="status-text">En ligne</span>
                                        </div>
                                    </div>
                                    
                                    <div class="friend-menu ms-auto">
                                        <button class="menu-button" type="button" data-bs-toggle="dropdown" aria-expanded="true">
                                            <span class="material-symbols-outlined">more_vert</span>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end custom-dropdown">
                                            <li>
                                                <a class="dropdown-item text-danger" href="#">
                                                    <span class="material-symbols-outlined">person_remove</span>
                                                    <span>Supprimer</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a class="dropdown-item text-danger" href="#">
                                                    <span class="material-symbols-outlined">block</span>
                                                    <span>Bloquer</span>
                                                </a>
                                            </li>
                                        </ul>                                        
                                    </div>
                                </div>
                                
                                <div class="friend-actions">
                                    <button class="action-button message-button" onclick="openChat('Joueur3')">
                                        <span class="material-symbols-outlined">chat</span>
                                        <span>Message</span>
                                    </button>
                                    <button class="action-button invite-button" enabled>
                                        <span class="material-symbols-outlined">sports_esports</span>
                                        <span>Inviter à jouer</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet Demandes -->
            <div class="tab-pane fade" id="requests" role="tabpanel" aria-labelledby="requests-tab">
                <div class="card mb-4">
                    <div class="card-header requests-header">
                        <h5 class="card-title mb-0">Demandes reçues</h5>
                        <div class="text-muted small">Demandes d'amis en attente</div>
                    </div>
                    <div class="card-body">
                        <ul class="list-group">
                            <!-- Demande 1 -->
                            <li class="list-group-item d-flex align-items-center">
                                <div class="friend-avatar me-3">
                                    <img src="../media/ficello.png" alt="Avatar">
                                </div>
                                <div class="friend-info">
                                    <h6 class="mb-0">Joueur4</h6>
                                </div>
                                <div class="ms-auto">
                                    <button class="btn btn-sm btn-success me-2">
                                        <i class="bi bi-check-lg me-1"></i>Accepter
                                    </button>
                                    <button class="btn btn-sm btn-danger">
                                        <i class="bi bi-x-lg me-1"></i>Refuser
                                    </button>
                                </div>
                            </li>
                            <!-- Demande 2 -->
                            <li class="list-group-item d-flex align-items-center">
                                <div class="friend-avatar me-3">
                                    <img src="../media/ficello.png" alt="Avatar">
                                </div>
                                <div class="friend-info">
                                    <h6 class="mb-0">Joueur5</h6>
                                </div>
                                <div class="ms-auto">
                                    <button class="btn btn-sm btn-success me-2">
                                        <i class="bi bi-check-lg me-1"></i>Accepter
                                    </button>
                                    <button class="btn btn-sm btn-danger">
                                        <i class="bi bi-x-lg me-1"></i>Refuser
                                    </button>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header requests-sent-header">
                        <h5 class="card-title mb-0">Demandes envoyées</h5>
                        <div class="text-muted small">Demandes en attente de réponse</div>
                    </div>
                    <div class="card-body">
                        <ul class="list-group">
                            <!-- Demande envoyée 1 -->
                            <li class="list-group-item d-flex align-items-center">
                                <div class="friend-avatar me-3">
                                    <img src="../media/ficello.png" alt="Avatar">
                                </div>
                                <div class="friend-info">
                                    <h6 class="mb-0">Joueur6</h6>
                                </div>
                                <div class="ms-auto">
                                    <button class="btn btn-sm btn-outline-danger">
                                        <i class="bi bi-x-lg me-1"></i>Annuler
                                    </button>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Onglet Bloqués -->
            <div class="tab-pane fade" id="blocked" role="tabpanel" aria-labelledby="blocked-tab">
                <div class="card">
                    <div class="card-header blocked-header">
                        <h5 class="card-title mb-0">Utilisateurs bloqués</h5>
                        <div class="text-muted small">Ces utilisateurs ne peuvent pas vous contacter</div>
                    </div>
                    <div class="card-body">
                        <ul class="list-group">
                            <!-- Utilisateur bloqué 1 -->
                            <li class="list-group-item d-flex align-items-center">
                                <div class="friend-avatar me-3">
                                    <img src="../media/ficello.png" alt="Avatar">
                                </div>
                                <div class="friend-info">
                                    <h6 class="mb-0">Joueur7</h6>
                                </div>
                                <div class="ms-auto">
                                    <button class="btn btn-sm btn-outline-secondary">
                                        <i class="bi bi-unlock-fill me-1"></i>Débloquer
                                    </button>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- Fin contenu des onglets -->
    </div>
</section>

<!-- Modal pour ajouter un ami -->
<div class="modal fade" id="addFriendModal" tabindex="-1" aria-labelledby="addFriendModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addFriendModalLabel">Ajouter un ami</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="friend-username" class="form-label">Nom d'utilisateur</label>
                    <input type="text" class="form-control" id="friend-username" placeholder="Entrez le nom d'utilisateur">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                <button type="button" class="btn btn-primary" id="send-friend-request">Envoyer la demande</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Ouvrir le modal d'ajout d'ami
        const addFriendBtn = document.getElementById('add-friend-btn');
        if (addFriendBtn) {
            addFriendBtn.addEventListener('click', function() {
                const addFriendModal = new bootstrap.Modal(document.getElementById('addFriendModal'));
                addFriendModal.show();
            });
        }
        
        // Envoyer une demande d'ami
        const sendFriendRequestBtn = document.getElementById('send-friend-request');
        if (sendFriendRequestBtn) {
            sendFriendRequestBtn.addEventListener('click', function() {
                const username = document.getElementById('friend-username').value;
                const message = document.getElementById('friend-message') ? document.getElementById('friend-message').value : '';
                
                if (username.trim() === '') {
                    alert('Veuillez entrer un nom d\'utilisateur');
                    return;
                }
                
                // Simuler l'envoi de la demande
                alert(`Demande d'ami envoyée à ${username}`);
                
                // Fermer le modal
                const addFriendModal = bootstrap.Modal.getInstance(document.getElementById('addFriendModal'));
                addFriendModal.hide();
                
                // Réinitialiser les champs
                document.getElementById('friend-username').value = '';
                if (document.getElementById('friend-message')) {
                    document.getElementById('friend-message').value = '';
                }
            });
        }
    });
    
    // Fonction pour ouvrir le chat avec un ami
    function openChat(username) {
        console.log(`Ouverture du chat avec ${username}`);
        if (typeof openChatWithUser === 'function') {
            openChatWithUser(username);
        } else {
            const chatLink = document.getElementById('openChatLink');
            if (chatLink) {
                chatLink.click();
            }
            alert(`Chat ouvert avec ${username}`);
        }
    }
</script>

